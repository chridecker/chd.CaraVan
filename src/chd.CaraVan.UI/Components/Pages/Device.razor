@page "/device/{Id:int}"
@using Microsoft.Extensions.Options
@using chd.CaraVan.Contracts.Dtos
@using chd.CaraVan.Contracts.Settings
@using chd.CaraVan.UI.Components.Pages.Cards
@using chd.CaraVan.UI.Implementations
@inject IOptionsMonitor<DeviceSettings> options
@inject IRuuviTagDataService dataService
<h3>@options.CurrentValue.RuuviTags.FirstOrDefault(x => x.Id == this.Id).Name</h3>


@if (data != null && data.Any())
{
    @foreach (var devData in data)
    {
        <DataCard Data="devData" />
    }
}

@code {
    [Parameter] public int Id { get; set; }

    DeviceDto device => options.CurrentValue.RuuviTags.FirstOrDefault(x => x.Id == this.Id);

    List<DeviceData> data = new();

    protected override Task OnInitializedAsync()
    {
        data.Add(dataService.GetData(this.device.Id, Contracts.Enums.EDataType.Temperature));
        data.Add(dataService.GetData(this.device.Id, Contracts.Enums.EDataType.Humidity));
        data.Add(dataService.GetData(this.device.Id, Contracts.Enums.EDataType.Pressure));
        data.Add(dataService.GetData(this.device.Id, Contracts.Enums.EDataType.BatteryLevel));

        return base.OnInitializedAsync();
    }

}
